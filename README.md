# PDO Console

Веб-консоль на `PHP`, позволяет работать с любыми базами данных через [PDO](https://www.php.net/manual/ru/class.pdo), создана по аналогии с веб-консолью [ClickHouse](https://play.clickhouse.com/play?user=play).

![PDO Console](dark.png)

## Описание

Редактора данных в текущей версии нет, есть только просмотр результата `SELECT` запроса, и отображение количества затронутых строк в остальных видах запросов.

Для одновременной работы с разными базами данных можно использовать параметр `?prefix=<название>`

При перезагрузке консоли выполнение последнего запроса НЕ присходит, для его запуска необходимо нажать кнопку `Run` или нажать на клавиатуре `Ctrl+Enter` или `Cmd+Enter`.

В текстовом поле SQL-запроса можно вводить отступы (шириной 4 пробела) кнопкой `Tab`, для возврата на предыдущие поля работает сочетание `Shift+Tab`.

Вводимый запрос сохраняется в адресной строке в `base64` кодировке после символа `#` по мере ввода (по событиям `onkeydown` и `onchange`), при перезагрузке страницы он будет раскодирован и помещён в поле ввода. При передаче кому-либо такой ссылки, передаётся лишь SQL-запрос без данных подключения к базе данных, их необходимо будет ввести вручную.

Выполненные SQL-запросы сохраняются в хранилище сеанса браузера `sessionStorage`, который стирается после закрытия вкладки с консолью. Стрелками справа внизу под полем ввода запроса можно перелистывать историю запросов. Если запрос уже есть в истории, то при запуске он переместится в конец списка.

Время выполнения запроса не учитывает время формирования его вывода, это то время, которое затрачивает база данных для его выполнения.

Если в таблице результата запроса более одного столбца, при нажатии на номер строки столбцы разворачиваются в строковое представление, повторное нажатие на номер строки возвращает прежний вид.

Вывод ограничен 1000 строками, для вывода остальных записей используйте SQL-параметры `LIMIT` и `OFFSET`.

Можно выбрать светлую и тёмную тему оформления, переключаются нажатием на иконку справа сверху. Выбранная тема сохраняется в локальном хранилище `localStorage` без префикса базы данных.

Все необходимые для работы файлы находятся внутри скрипта `pdoconsole.php`, и загружаются однократно вместе с телом страницы. Кроме нескольких иконок, внедрён код библиотек: `bootstrap.min.css` для стилизации консоли, и код `htmx.min.js` для AJAX-запросов к серверу.

## Безопасность

Строка подключения к базе данных, имя пользователя и пароль, хранятся в зашифрованном виде (`AES128`) в `cookie` вашего браузера в течении года от последнего использования, срок хранения можно изменить в константе `COOKIE_EXPIRES`. Для надёжного хранения этих данных необходимо поменять значение константы `CRYPT_PASS` на своё уникальное значение.

От межсайтовых запросов консоль защищена проверкой `md5` хеша ключа шифрования `CRYPT_PASS`, и наличием пароля к базе данных в теле запроса.

С осторожностью используйте консоль на сайтах, где может быть внедрён чужой JS-код, так как он может получить доступ к вашим SQL-запросам во время сеанса работы с консолью, в это время не открывайте сайт в этом же браузере.

Если вы получили ссылку с запросом на свою консоль от других людей, внимательно проверяйте тело запроса перед запуском на отсутствие опасных команд, например, стирания или изменения записей в базе данных: `DROP`, `DELETE`, `UPDATE`.

## Установка

Скрипт `pdoconsole.php` можно положить в любое место вашего сайта, желательно переименовать файл, чтобы к нему не получили доступ указав стандартное имя файла, с удалёнными серверами необходимо работать только через протокол `https`, так как пароль передаётся на сервер в теле POST-запроса.

Перед использованием поменяйте значение константы `CRYPT_PASS` (в начале файла) на любое случайное значение.

Для запуска скрипта можно использовать встроенный в PHP веб-сервер:

	$ php -S localhost:8089 pdoconsole.php
